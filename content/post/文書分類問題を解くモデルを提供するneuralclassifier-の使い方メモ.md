+++
title = "文書分類問題を解くモデルを提供するNeuralClassifier の使い方メモ"
date = 2020-06-15T02:11:00Z
updated = 2020-12-16T13:02:58Z
tags = ["技術系"]
blogimport = true 
[author]
	name = "サブカル科学研究会"
	uri = "https://draft.blogger.com/profile/00849312168396849001"
+++

<p name="hjNiZ" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;"><span style="box-sizing: inherit; font-weight: 700; margin: 0px; padding: 0px;"><br /></span></p><p name="hjNiZ" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;"><span style="box-sizing: inherit; font-weight: 700; margin: 0px; padding: 0px;"></span></p><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-YlMb8v77MN4/XurdQSzS1yI/AAAAAAAAg6Y/oSZrJ0c9yxYbzQnNNTynRvZnEp-xGE7NwCK4BGAsYHg/s1920/AFE90C8A-A49C-4475-9F05-50E2D56D5B63.jpeg" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1280" data-original-width="1920" src="https://1.bp.blogspot.com/-YlMb8v77MN4/XurdQSzS1yI/AAAAAAAAg6Y/oSZrJ0c9yxYbzQnNNTynRvZnEp-xGE7NwCK4BGAsYHg/s320/AFE90C8A-A49C-4475-9F05-50E2D56D5B63.jpeg" width="320" /></a></div>NeuralClassifier: An Open-source Neural Hierarchical Multi-label Text Classification Toolkit&nbsp;はTencentが公開しているマルチラベルな文書分類問題用のpythonライブラリです。<br style="box-sizing: inherit; margin: 0px; padding: 0px;" /><p></p><p name="6mD7k" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">詳しくは</p><p name="JYWSI" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;"><br /></p><blockquote class="embedly-card"><h4><a href="https://github.com/Tencent/NeuralNLP-NeuralClassifier">Tencent/NeuralNLP-NeuralClassifier</a></h4><p>NeuralClassifier is designed for quick implementation of neural models for hierarchical multi-label classification task, which is more challenging and common in real-world scenarios. A salient feature is that NeuralClassifier currently provides a variety of text encoders, such as FastText, TextCNN, TextRNN, RCNN, VDCNN, DPCNN, DRNN, AttentiveConvNet and Transformer encoder, etc.</p></blockquote> <script async="" charset="UTF-8" src="//cdn.embedly.com/widgets/platform.js"></script><p name="FOFkZ" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">を参照しましょう。</p><p name="FOFkZ" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">さて、以下ではこのライブラリの使い方を開設します。</p><nav class="o-indexHeading" data-v-72cc1522="" data-v-7e649226="" style="-webkit-text-size-adjust: 100%; background-color: #f7f9f9; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; margin: 36px 0px; padding: 16px;"><h4 class="o-indexHeading__title is-open" data-v-7e649226="" style="box-sizing: inherit; color: #787c7b; font-family: inherit; font-size: 14px; margin: 0px; padding: 0px 0px 0px 16px; position: relative;"><button aria-label="arrowdropdown" class="o-indexHeading__dropdown a-icon a-icon--arrowdropdown a-icon--size_medium" data-v-7e649226="" style="background-color: transparent; border-bottom-left-radius: 24px; border-bottom-right-radius: 24px; border-top-left-radius: 24px; border-top-right-radius: 24px; border: none; box-sizing: inherit; color: inherit; cursor: pointer; font-family: icon; font-size: 24px; font-stretch: inherit; font-style: inherit; font-variant-caps: inherit; height: 24px; left: -8px; line-height: 1; margin: 0px; overflow: visible; padding-left: 0px; padding-right: 0px; position: absolute; top: -1px; touch-action: manipulation; transform: rotate(0deg); vertical-align: top; width: 24px;"></button>目次</h4><div class="o-indexHeading__body" data-v-7e649226="" style="box-sizing: inherit; margin: 0px; padding: 0px;"><ol class="o-indexHeading__list" data-v-7e649226="" style="box-sizing: inherit; list-style: none; margin: 0px; padding: 0px;"><li class="o-indexHeading__item" data-v-7e649226="" style="border-top-style: none; box-sizing: inherit; font-size: 14px; list-style-type: none; margin: 0px; padding: 20px 0px 8px;"><a class="o-indexHeading__link" data-v-7e649226="" style="background-color: transparent; box-sizing: inherit; color: #787c7b; cursor: pointer; display: block; margin: 0px; padding: 0px; text-decoration: underline;">環境設定</a></li><li class="o-indexHeading__item" data-v-7e649226="" style="border-top-color: rgb(230, 230, 230); border-top-style: solid; border-top-width: 1px; box-sizing: inherit; font-size: 14px; list-style-type: none; margin: 0px; padding: 8px 0px;"><a class="o-indexHeading__link" data-v-7e649226="" style="background-color: transparent; box-sizing: inherit; color: #787c7b; cursor: pointer; display: block; margin: 0px; padding: 0px; text-decoration: underline;">実行方法</a></li><li class="o-indexHeading__item" data-v-7e649226="" style="border-top-color: rgb(230, 230, 230); border-top-style: solid; border-top-width: 1px; box-sizing: inherit; font-size: 14px; list-style-type: none; margin: 0px; padding: 8px 0px;"><a class="o-indexHeading__link" data-v-7e649226="" style="background-color: transparent; box-sizing: inherit; color: #787c7b; cursor: pointer; display: block; margin: 0px; padding: 0px; text-decoration: underline;">conf/train.json の設定</a></li><li class="o-indexHeading__item" data-v-7e649226="" style="border-top-color: rgb(230, 230, 230); border-top-style: solid; border-top-width: 1px; box-sizing: inherit; font-size: 14px; list-style-type: none; margin: 0px; padding: 8px 0px;"><a class="o-indexHeading__link" data-v-7e649226="" style="background-color: transparent; box-sizing: inherit; color: #787c7b; cursor: pointer; display: block; margin: 0px; padding: 0px; text-decoration: underline;">入力データの形式</a></li></ol></div></nav><h2 style="text-align: left;">環境設定</h2><p name="tI4d8" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">pytorch に依存しているライブラリなので、あらかじめ以下のコマンドでinstallしておきます。</p><pre class="p-textNoteCode" data-name="preCode" name="cHHRW" style="-webkit-text-size-adjust: 100%; background-color: #282c34; box-sizing: inherit; color: white; font-size: 12px; line-height: 18px; margin: 32px -16px; padding: 24px; white-space: pre-wrap;"><code class="p-textNoteCode__main hljs" data-name="code" style="-webkit-overflow-scrolling: touch; box-sizing: inherit; display: block; line-height: 18px; margin: 0px; overflow-x: auto; padding: 0.5em; white-space: pre; word-wrap: normal;">pip install torch</code></pre><p name="5LvVD" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">また、作業用のディレクトリにレポジトリをcloneします。今回はzipをダウンロードして用いました。</p><h2 style="text-align: left;">実行方法</h2><p name="ZoFkB" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">コマンドラインから.pyファイルをそれぞれ実行することで、学習、評価、予測を行います。</p><pre class="p-textNoteCode" data-name="preCode" name="8jTwC" style="-webkit-text-size-adjust: 100%; background-color: #282c34; box-sizing: inherit; color: white; font-size: 12px; line-height: 18px; margin: 32px -16px; padding: 24px; white-space: pre-wrap;"><code class="p-textNoteCode__main hljs" data-name="code" style="-webkit-overflow-scrolling: touch; box-sizing: inherit; display: block; line-height: 18px; margin: 0px; overflow-x: auto; padding: 0.5em; white-space: pre; word-wrap: normal;">python train.py conf/train.json</code></pre><p name="2GQ00" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">conf/train.json に実行時の設定が記述されています。必要に応じて変更します。</p><pre class="p-textNoteCode" data-name="preCode" name="qoNYB" style="-webkit-text-size-adjust: 100%; background-color: #282c34; box-sizing: inherit; color: white; font-size: 12px; line-height: 18px; margin: 32px -16px; padding: 24px; white-space: pre-wrap;"><code class="p-textNoteCode__main hljs javascript" data-name="code" style="-webkit-overflow-scrolling: touch; box-sizing: inherit; display: block; line-height: 18px; margin: 0px; overflow-x: auto; padding: 0.5em; white-space: pre; word-wrap: normal;">python <span class="hljs-built_in" style="box-sizing: inherit; color: #e6c07b; margin: 0px; padding: 0px;">eval</span>.py conf/train.json</code></pre><p name="P2wxF" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">で学習済みのモデルを評価できます。</p><p name="yAb9d" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">各ラベルに対してprecision、 recall 、f value をまとめたものと混合行列を、それぞれ.txt形式で出力します。</p><h2 style="text-align: left;">conf/train.json の設定</h2><p name="IqHGS" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">各種モデルのハイパーパラメータや学習、評価時に利用されるモデルの選択について記述されています。<br style="box-sizing: inherit; margin: 0px; padding: 0px;" /></p><p name="omcVt" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">主に必要なのは、cpuかgpuの指定、入力データの情報、学習と評価に用いるモデルの選択に関しての記述になります。</p><p name="omcVt" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;"><br /></p><p name="omcVt" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">num＿workerで警告が出たので0に変更すると解消した。</p><p name="dwTp5" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">入力データは指定の形式を守って作成し、パスを指定します。</p><p name="Ugcxc" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">モデルの指定は学習用のモデルの指定と評価用のモデルの指定が独立して別に存在するので、注意すること。</p><h2 style="text-align: left;">入力データの形式</h2><pre class="p-textNoteCode" data-name="preCode" name="Bmiu1" style="-webkit-text-size-adjust: 100%; background-color: #282c34; box-sizing: inherit; color: white; font-size: 12px; line-height: 18px; margin: 32px -16px; padding: 24px; white-space: pre-wrap;"><code class="p-textNoteCode__main hljs javascript" data-name="code" style="-webkit-overflow-scrolling: touch; box-sizing: inherit; display: block; line-height: 18px; margin: 0px; overflow-x: auto; padding: 0.5em; white-space: pre; word-wrap: normal;"><span class="hljs-built_in" style="box-sizing: inherit; color: #e6c07b; margin: 0px; padding: 0px;">JSON</span> example:<br /><br />{<br />   <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"doc_label"</span>: [<span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"Computer--MachineLearning--DeepLearning"</span>, <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"Neuro--ComputationalNeuro"</span>],<br />   <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"doc_token"</span>: [<span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"I"</span>, <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"love"</span>, <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"deep"</span>, <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"learning"</span>],<br />   <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"doc_keyword"</span>: [<span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"deep learning"</span>],<br />   <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"doc_topic"</span>: [<span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"AI"</span>, <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"Machine learning"</span>]<br />}<br />{<br />   <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"doc_label"</span>: [<span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"Computer--MachineLearning--DeepLearning"</span>],<br />   <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"doc_token"</span>: [<span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"I"</span>, <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"love"</span>, <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"deep"</span>, <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"learning"</span>],<br />   <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"doc_keyword"</span>: [<span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"deep learning"</span>],<br />   <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"doc_topic"</span>: [<span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"AI"</span>, <span class="hljs-string" style="box-sizing: inherit; color: #98c379; margin: 0px; padding: 0px;">"Machine learning"</span>]<br />}</code></pre><p name="UyrLj" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">この形式で作成すること！</p><p name="bxKcn" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">厳密にはjsonの形式を守ってはいないので、pythonでデータを作成する際にはdictデータをjsonで出力する方法は取れません。諦めて、ファイルに一行ずつ書き込むのがよいです。</p><p name="M7Bep" style="-webkit-text-size-adjust: 100%; box-sizing: inherit; caret-color: rgb(34, 34, 34); color: #222222; font-size: 16px; line-height: 30px; margin: 30px 0px; padding: 0px;">またこの例ではマルチラベルの例を示しているが、シングルラベルの場合にも要素数が1のリスト形式とすることに注意しましょう。私はそこでハマりました。</p><h2 style="text-align: left;"><b>文書分類問題の応用について</b></h2><br class="Apple-interchange-newline" style="-webkit-text-size-adjust: auto;" /> <blockquote class="embedly-card"><h4><a href="https://www.subcul-science.com/2020/06/blog-post_54.html">文書分類問題の応用はなにがある？</a></h4><p>機械学習について勉強したけど、その使い道が分からん！ってなってないですか？ …</p></blockquote> <script async="" charset="UTF-8" src="//cdn.embedly.com/widgets/platform.js"></script> <!--START MoshimoAffiliateEasyLink--><script type="text/javascript">(function(b,c,f,g,a,d,e){b.MoshimoAffiliateObject=a; b[a]=b[a]||function(){arguments.currentScript=c.currentScript ||c.scripts[c.scripts.length-2];(b[a].q=b[a].q||[]).push(arguments)}; c.getElementById(a)||(d=c.createElement(f),d.src=g, d.id=a,e=c.getElementsByTagName("body")[0],e.appendChild(d))}) (window,document,"script","//dn.msmstatic.com/site/cardlink/bundle.js","msmaflink"); msmaflink({"n":"自然言語処理の基本と技術","b":"","t":"","d":"https:\/\/m.media-amazon.com","c_p":"","p":["\/images\/I\/51V9d2v9Z9L.jpg"],"u":{"u":"https:\/\/www.amazon.co.jp\/dp\/B01CGAPLLO","t":"amazon","r_v":""},"aid":{"amazon":"2220302","rakuten":"2220301","yahoo":"2220303"},"eid":"Vza6T","s":"s"}); </script><div id="msmaflink-Vza6T">リンク</div><!--MoshimoAffiliateEasyLink END-->
