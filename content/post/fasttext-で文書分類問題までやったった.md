+++
title = "Fasttext で文書分類問題までやったった"
date = 2020-06-13T07:29:00Z
updated = 2020-12-04T13:51:13Z
tags = ["技術系"]
blogimport = true 
[author]
	name = "サブカル科学研究会"
	uri = "https://draft.blogger.com/profile/00849312168396849001"
+++

<head>      <meta charset="utf-8">      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/monokai-sublime.min.css" integrity="sha256-kTdkFYZP3TqSvlJAUiZ6/s5L2xu4xsdU9eYMWsKOk74=" crossorigin="anonymous">			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css" integrity="sha256-HbgiGHMLxHZ3kkAiixyvnaaZFNjNWLYKD/QG6PWaQPc=" crossorigin="anonymous">			<link rel="stylesheet" href="/css/guest.bundle.css?v=0.13.0"><style type="text/css">      .markdown-body { 			  box-sizing: border-box; 			  min-width: 200px; 			  max-width: 980px; 			  margin: 0 auto; 			  padding: 45px; 			} 			.markdown-body pre { 			  background: #23241f; 			} 			.markdown-body strong, 			.markdown-body h1, 			.markdown-body h2, 			.markdown-body h3, 			.markdown-body h4, 			.markdown-body h5 { 			  font-weight: 700; 			} 			@media (max-width: 767px) { 			  .markdown-body { 			    padding: 15px; 			  } 			}</style><script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><title>Fasttext で文書分類問題までやったった</title></head><body><div class="markdown-body"><ul><li><a href='#Fasttext_で文書分類問題までやったったのまとめ'>Fasttext で文書分類問題までやったったのまとめ</a></li><li><a href='#前振り'>前振り</a></li><li><a href='#Fasttext_ライブラリの特徴'>Fasttext ライブラリの特徴</a></li><li><a href='#Fasttext_ライブラリの使い方'>Fasttext ライブラリの使い方</a></li><li><a href='#文書分類問題での使い方'>文書分類問題での使い方</a></li><li><a href='#まとめ'>まとめ</a></li></ul> <h1 id="Fasttext_で文書分類問題までやったった" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">Fasttext で文書分類問題までやったった<a href="#Fasttext_で文書分類問題までやったった" title="Fasttext_で文書分類問題までやったった"><i class="fas fa-link ml-1" style="display:none;"></i></a></h1><h2 id="Fasttext_で文書分類問題までやったったのまとめ" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">Fasttext で文書分類問題までやったったのまとめ<a href="#Fasttext_で文書分類問題までやったったのまとめ" title="Fasttext_で文書分類問題までやったったのまとめ"><i class="fas fa-link ml-1" style="display:none;"></i></a></h2><ul><li>Facebook research がFasttextを使った文書分類ライブラリを公開してる</li><li>Fasttext のpython 環境でのinstall 方法は簡単</li><li>実行時間は早い<h2 id="前振り" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">前振り<a href="#前振り" title="前振り"><i class="fas fa-link ml-1" style="display:none;"></i></a></h2></li></ul><p>文書分類のタスクに取り組むことになり、当初は、</p><blockquote><p>NeuralClassifier: An Open-source Neural Hierarchical Multi-label Text Classification Toolkit </p></blockquote><p>を使っていました。ですが、あまり精度が出ませんでした。</p><p>上司に教えてもらったのが、</p><blockquote><p>[2] A. Joulin, E. Grave, P. Bojanowski, T. Mikolov, Bag of Tricks for Efficient Text Classification </p></blockquote><p>でした。</p><h2 id="Fasttext_ライブラリの特徴" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">Fasttext ライブラリの特徴<a href="#Fasttext_ライブラリの特徴" title="Fasttext_ライブラリの特徴"><i class="fas fa-link ml-1" style="display:none;"></i></a></h2><p>これはFasttextを用いて文書分類問題をend-to-endで解いてくれるライブラリになります。</p><p>そのため、文書ベクトルを分類タスク様に最適化できる仕様になっています。</p><p>学習にかかる時間も数秒以内と非常に速く、たたき台としては有効です。</p><p>また、性能も悪くありません。<a href="https://fasttext.cc/docs/en/autotune.html">ハイパーパラメータチューニング</a>もできます。</p><p>基本は上記の通りです。</p><p>固定したいパラメータ(分散表現の次元数など)だけ指定し以下のように実行します。</p><pre><code class="language-python">model = fasttext.train_supervised(input=&#39;cooking.train&#39;, autotuneValidationFile=&#39;cooking.valid&#39;)</code></pre><p>ここで&#39;cooking.train&#39;と &#39;cooking.valid&#39;は指定の形式のテキストファイルとなります。</p><h2 id="Fasttext_ライブラリの使い方" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">Fasttext ライブラリの使い方<a href="#Fasttext_ライブラリの使い方" title="Fasttext_ライブラリの使い方"><i class="fas fa-link ml-1" style="display:none;"></i></a></h2><pre><code>pip install fasttext</code></pre><p>上のコマンドだけで、2020年6月時点ではpython用のfastText環境が整います。 非常に簡単です。</p><h2 id="文書分類問題での使い方" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">文書分類問題での使い方<a href="#文書分類問題での使い方" title="文書分類問題での使い方"><i class="fas fa-link ml-1" style="display:none;"></i></a></h2><p>教師データとして&#39;data.train.txt&#39;を作成する必要があります。</p><p>データの形式は&quot;<strong>label</strong>&quot;とトークナイズされた文書を各行に持つテキストファイルです。</p><pre><code>train.txt <br /><br />__label__1  愛 が 重 い<br />__label__2  愛 し て ます</code></pre><p>同様にして教師データと同じ形式でテストデータ等を作成します。</p><p>モデルの訓練は以下のコードを実行します。</p><pre><code>import fasttext<br /><br />model = fasttext.train_supervised(&#39;train.txt&#39;)</code></pre><p>学習時間は教師データの量に依存するが、CPUで対応可能であり、手元のデータ(約1000件)では数秒で学習が終了しました。</p><p>学習したモデルを用いた推定結果は以下のようにして得られます。</p><pre><code>model.predict(&quot;あなた は 愛 を 信じ ます か ？&quot;)</code></pre><p>この時、分類されるクラスと予測確率の配列が返されます。</p><p>以上によって、fastTextを用いた文書分類問題が解かれます。</p><p>評価</p><p>sklearnを用いて混合行列や精度比較が出来ます。</p><p>以下はscikit-learnの公式サイトからの引用です。</p><pre><code>from sklearn.metrics import confusion_matrix<br /><br />y_true = [&quot;cat&quot;, &quot;ant&quot;, &quot;cat&quot;, &quot;cat&quot;, &quot;ant&quot;, &quot;bird&quot;]<br />y_pred = [&quot;ant&quot;, &quot;ant&quot;, &quot;cat&quot;, &quot;cat&quot;, &quot;ant&quot;, &quot;cat&quot;]<br />confusion_matrix(y_true, y_pred, labels=[&quot;ant&quot;, &quot;bird&quot;, &quot;cat&quot;])<br />array([[2, 0, 0],<br />      [0, 0, 1],<br />      [1, 0, 2]])</code></pre><pre><code class="language-python">from sklearn.metrics import classification_report<br />y_true = [0, 1, 2, 2, 2]<br />y_pred = [0, 0, 2, 2, 1]<br />target_names = [&#39;class 0&#39;, &#39;class 1&#39;, &#39;class 2&#39;]<br />print(classification_report(y_true, y_pred, target_names=target_names))<br />             precision    recall  f1-score   support<br />&lt;BLANKLINE&gt;<br />    class 0       0.50      1.00      0.67         1<br />    class 1       0.00      0.00      0.00         1<br />    class 2       1.00      0.67      0.80         3<br />&lt;BLANKLINE&gt;<br />   accuracy                           0.60         5<br />  macro avg       0.50      0.56      0.49         5<br />weighted avg       0.70      0.60</code></pre><h2 id="まとめ" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">まとめ<a href="#まとめ" title="まとめ"><i class="fas fa-link ml-1" style="display:none;"></i></a></h2><p>fastText とscikit-learnを利用することで、</p><p>python 環境下で、</p><p>簡単に文書分類問題に取り組むことが出来ます。</p><p>python はデータセット作成時にも便利なので、ひとまず文書分類を試したいという場合には有効な選択肢の一つです。</p><p>実応用については下記のリンクを参考にしてください。</p><p><a href="https://www.subcul-science.com/2020/06/blog-post_54.html">文書分類問題の応用はなにがある？</a></p></div></body><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script><script type="text/javascript">hljs.initHighlightingOnLoad();</script><script>		  $(document).on("mouseover", "h1,h2,h3,h4,h5", function(e) { 		    $(e.currentTarget).find(".fa-link").text("🔗").show(); 		  }); 		  $(document).on("mouseout", "h1,h2,h3,h4,h5", function(e) { 		    $(e.currentTarget).find(".fa-link").hide(); 		  });</script> 参考資料  機械学習・深層学習による自然言語処理入門　scikit-learnとTensorFlowを使った実践プログラミング  <div class="booklink-box" style="text-align:left;padding-bottom:20px;font-size:small;zoom: 1;overflow: hidden;"><div class="booklink-image" style="float:left;margin:0 15px 10px 0;"><a href="//af.moshimo.com/af/c/click?a_id=2220302&p_id=170&pc_id=185&pl_id=4062&s_v=b5Rz2P0601xu&url=https%3A%2F%2Fwww.amazon.co.jp%2Fexec%2Fobidos%2FASIN%2F4839966605" target="_blank" ><img src="" style="border: none;" /></a><img src="//i.moshimo.com/af/i/impression?a_id=2220302&p_id=170&pc_id=185&pl_id=4062" width="1" height="1" style="border:none;"></div><div class="booklink-info" style="line-height:120%;zoom: 1;overflow: hidden;"><div class="booklink-name" style="margin-bottom:10px;line-height:120%"><a href="//af.moshimo.com/af/c/click?a_id=2220302&p_id=170&pc_id=185&pl_id=4062&s_v=b5Rz2P0601xu&url=https%3A%2F%2Fwww.amazon.co.jp%2Fexec%2Fobidos%2FASIN%2F4839966605" target="_blank" ></a><img src="//i.moshimo.com/af/i/impression?a_id=2220302&p_id=170&pc_id=185&pl_id=4062" width="1" height="1" style="border:none;"><div class="booklink-powered-date" style="font-size:8pt;margin-top:5px;font-family:verdana;line-height:120%">posted with <a href="https://yomereba.com" rel="nofollow" target="_blank">ヨメレバ</a></div></div><div class="booklink-detail" style="margin-bottom:5px;"></div><div class="booklink-link2" style="margin-top:10px;"><div class="shoplinkamazon" style="display:inline;margin-right:5px;background: url('//img.yomereba.com/yl.gif') 0 0 no-repeat;padding: 2px 0 2px 18px;white-space: nowrap;"><a href="//af.moshimo.com/af/c/click?a_id=2220302&p_id=170&pc_id=185&pl_id=4062&s_v=b5Rz2P0601xu&url=https%3A%2F%2Fwww.amazon.co.jp%2Fexec%2Fobidos%2FASIN%2F4839966605" target="_blank" >Amazonで購入</a><img src="//i.moshimo.com/af/i/impression?a_id=2220302&p_id=170&pc_id=185&pl_id=4062" width="1" height="1" style="border:none;"></div><div class="shoplinkkindle" style="display:inline;margin-right:5px;background: url('//img.yomereba.com/yl.gif') 0 0 no-repeat;padding: 2px 0 2px 18px;white-space: nowrap;"><a href="//af.moshimo.com/af/c/click?a_id=2220302&p_id=170&pc_id=185&pl_id=4062&s_v=b5Rz2P0601xu&url=https%3A%2F%2Fwww.amazon.co.jp%2Fgp%2Fsearch%3Fkeywords%3D%26__mk_ja_JP%3D%2583J%2583%255E%2583J%2583i%26url%3Dnode%253D2275256051" target="_blank" >Kindleで購入</a><img src="//i.moshimo.com/af/i/impression?a_id=2220302&p_id=170&pc_id=185&pl_id=4062" width="1" height="1" style="border:none;"></div><div class="shoplinkrakuten" style="display:inline;margin-right:5px;background: url('//img.yomereba.com/yl.gif') 0 -50px no-repeat;padding: 2px 0 2px 18px;white-space: nowrap;"><a href="//af.moshimo.com/af/c/click?a_id=2220301&p_id=56&pc_id=56&pl_id=637&s_v=b5Rz2P0601xu&url=http%3A%2F%2Fbooks.rakuten.co.jp%2Frb%2F16190713%2F" target="_blank" >楽天ブックスで購入</a><img src="//i.moshimo.com/af/i/impression?a_id=2220302&p_id=170&pc_id=185&pl_id=4062" width="1" height="1" style="border:none;"></div><div class="shoplinkrakukobo" style="display:inline;margin-right:5px;background: url('//img.yomereba.com/yl.gif') 0 -50px no-repeat;padding: 2px 0 2px 18px;white-space: nowrap;"><a href="//af.moshimo.com/af/c/click?a_id=2220301&p_id=56&pc_id=56&pl_id=637&s_v=b5Rz2P0601xu&url=https%3A%2F%2Fbooks.rakuten.co.jp%2Frk%2F350e869d324d356eb91b3b52d00d0e36%2F" target="_blank" >楽天koboで購入</a><img src="//i.moshimo.com/af/i/impression?a_id=2220301&p_id=56&pc_id=56&pl_id=637" width="1" height="1" style="border:none;"></div>	  <div class="shoplinkseven" style="display:inline;margin-right:5px;background: url('//img.yomereba.com/yl.gif') 0 -100px no-repeat;padding: 2px 0 2px 18px;white-space: nowrap;"><a href="//af.moshimo.com/af/c/click?a_id=2317554&p_id=932&pc_id=1188&pl_id=12456&s_v=b5Rz2P0601xu&url=http%3A%2F%2F7net.omni7.jp%2Fsearch%2F%3FsearchKeywordFlg%3D1%26keyword%3D9784839966607" target="_blank" >7netで購入<img src="//i.moshimo.com/af/i/impression?a_id=2317554&p_id=932&pc_id=1188&pl_id=12456" width="1" height="1" style="border:none;"></a></div>            	  	  	  	      </div></div><div class="booklink-footer" style="clear: left"></div></div>
