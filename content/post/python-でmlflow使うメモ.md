+++
title = "python でmlflow使うメモ"
date = 2020-07-18T16:24:00Z
updated = 2020-07-18T16:24:06Z
tags = ["技術系"]
blogimport = true 
[author]
	name = "サブカル科学研究会"
	uri = "https://draft.blogger.com/profile/00849312168396849001"
+++

<html><head>      <meta charset="utf-8">      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/monokai-sublime.min.css" integrity="sha256-kTdkFYZP3TqSvlJAUiZ6/s5L2xu4xsdU9eYMWsKOk74=" crossorigin="anonymous">			<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css" integrity="sha256-HbgiGHMLxHZ3kkAiixyvnaaZFNjNWLYKD/QG6PWaQPc=" crossorigin="anonymous">			<link rel="stylesheet" href="/css/guest.bundle.css?v=0.13.0"><style type="text/css">      .markdown-body { 			  box-sizing: border-box; 			  min-width: 200px; 			  max-width: 980px; 			  margin: 0 auto; 			  padding: 45px; 			} 			.markdown-body pre { 			  background: #23241f; 			} 			.markdown-body strong, 			.markdown-body h1, 			.markdown-body h2, 			.markdown-body h3, 			.markdown-body h4, 			.markdown-body h5 { 			  font-weight: 700; 			} 			@media (max-width: 767px) { 			  .markdown-body { 			    padding: 15px; 			  } 			}</style><script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><title>python でmlflow使うメモ</title></head><body><div class="markdown-body"><h1 id="python_でmlflow使うメモ" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">python でmlflow使うメモ<a href="#python_でmlflow使うメモ" title="python_でmlflow使うメモ"><i class="fas fa-link ml-1" style="display:none;"></i></a></h1><p>実験結果を比較するために便利っぽいので使ってみた。使う際の手順をメモしておく。</p><p>目次</p><ul><li><a href='#mlflow_のインストール'>mlflow のインストール</a></li><li><a href='#クイックスタート'>クイックスタート</a></li><li><a href='#実験の種類ごとに枠を作る'>実験の種類ごとに枠を作る</a></li><li><a href='#実験結果の比較'>実験結果の比較</a></li><li><a href='#今回のはまりどころ'>今回のはまりどころ</a></li></ul> <h2 id="mlflow_のインストール" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">mlflow のインストール<a href="#mlflow_のインストール" title="mlflow_のインストール"><i class="fas fa-link ml-1" style="display:none;"></i></a></h2><pre><code>pip install mlflow</code></pre><h2 id="クイックスタート" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">クイックスタート<a href="#クイックスタート" title="クイックスタート"><i class="fas fa-link ml-1" style="display:none;"></i></a></h2><p>pythonで以下のような記述を用いる。</p><pre><code>with mlflow.start_run():<br />   mlflow.log_param(&quot;a&quot;, 1)<br />   mlflow.log_metric(&quot;b&quot;, 2)<br />   mlflow.log_artifact(&quot;output.txt&quot;)</code></pre><p>log_paramにはパラメータを入れる。</p><p>log_metricには損失関数や評価指標を入れる。valueには数値しか受け付けない。</p><p>log_params({&quot;example&quot;:hoge，“example2”：True})の方が便利。 同様にlog_metricsもある。</p><p>log_artifact でファイルを保存できる(csvやjsonなど)。metricの書式に当てはまらないものをこちらで保存する。</p><h2 id="実験の種類ごとに枠を作る" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">実験の種類ごとに枠を作る<a href="#実験の種類ごとに枠を作る" title="実験の種類ごとに枠を作る"><i class="fas fa-link ml-1" style="display:none;"></i></a></h2><p>CLI で以下を実行してexperimentを作成する。</p><pre><code>mlflow experiments create --experiment-name fraud-detection</code></pre><p>CLI でexperimentが作成されたことを確認。</p><p>experiment _idをメモしておく。</p><pre><code>mlflow experiments list<br /></code></pre><p>以下のようにpythonで記述して、experimentを指定する。</p><pre><code>mlflow.set_experiment(&#39;experiment_name&#39;)<br /><br />with mlflow.start_run():<br />   mlflow.log_param(&quot;a&quot;, 1)<br />   mlflow.log_metric(&quot;b&quot;, 2)<br />   mlflow.log_artifact(&quot;output.txt&quot;)<br /></code></pre><h2 id="実験結果の比較" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">実験結果の比較<a href="#実験結果の比較" title="実験結果の比較"><i class="fas fa-link ml-1" style="display:none;"></i></a></h2><p>CLIでサーバーを立ち上げる。</p><pre><code>mlflow ui</code></pre><p>表示されたアドレスをブラウザで開く。</p><p>サーバーを落とす時はkillする。(あんまりスマートじゃないなぁ？)</p><h2 id="今回のはまりどころ" onmouseover="this.querySelector('a .fa-link').style.display='inline-block'" onmouseout="this.querySelector('a .fa-link').style.display='none'">今回のはまりどころ<a href="#今回のはまりどころ" title="今回のはまりどころ"><i class="fas fa-link ml-1" style="display:none;"></i></a></h2><p>experiment を新しく作成して、 新たにサーバーを立ち上げようとするときにエラーが出るときは、 既にサーバーが立ち上がってるのかも。</p><p>kill して対応した。</p></div></body><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script><script type="text/javascript">hljs.initHighlightingOnLoad();</script><script>		  $(document).on("mouseover", "h1,h2,h3,h4,h5", function(e) { 		    $(e.currentTarget).find(".fa-link").text("🔗").show(); 		  }); 		  $(document).on("mouseout", "h1,h2,h3,h4,h5", function(e) { 		    $(e.currentTarget).find(".fa-link").hide(); 		  });</script></html>
